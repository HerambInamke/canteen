<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart - CanteenHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bites-nav">
        <div class="container">
            <a class="navbar-brand bites-logo" href="../index.html">
                <span class="logo-main">CANTEENHUB</span>
                <span class="logo-sub">COLLEGE CANTEEN</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto bites-nav-links">
                    <li class="nav-item"><a class="nav-link" href="../index.html">HOME</a></li>
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">DASHBOARD</a></li>
                    <li class="nav-item"><a class="nav-link" href="menu.html">MENU</a></li>
                    <li class="nav-item"><a class="nav-link" href="feedback.html">FEEDBACK</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">ABOUT US</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">CONTACT US</a></li>
                    <li class="nav-item">
                        <a class="nav-link active" href="cart.html">CART <span class="badge bg-danger ms-1" data-cart-count style="display:none">0</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="py-5 mt-5" style="background:#1a1a1a; min-height: 100vh;">
        <div class="container">
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8 text-center">
                    <p class="section-subtitle-bites">your selections</p>
                    <h1 class="section-title-bites">YOUR CART</h1>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card" style="background:#2a2a2a; border:1px solid #333;">
                        <div class="card-body">
                            <div id="cartItemsContainer" class="vstack gap-3"></div>
                            <div id="emptyCart" class="text-center py-5" style="display:none;">
                                <i class="fas fa-shopping-cart fa-3x mb-3" style="color:#ff6b35;"></i>
                                <p class="mb-3">Your cart is empty.</p>
                                <a href="menu.html" class="btn btn-primary">Go to Menu</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card" style="background:#2a2a2a; border:1px solid #333;">
                        <div class="card-body">
                            <h5 class="mb-3">Order Summary</h5>
                            <div class="d-flex justify-content-between mb-2"><span>Subtotal</span><span id="subtotal">₹0</span></div>
                            <div class="d-flex justify-content-between mb-2"><span>Tax (5%)</span><span id="tax">₹0</span></div>
                            <div class="d-flex justify-content-between mb-3"><strong>Total</strong><strong id="total">₹0</strong></div>
                            <button id="checkoutBtn" class="btn btn-primary w-100 mb-2">Checkout</button>
                            <button id="clearCartBtn" class="btn btn-outline-danger w-100">Clear Cart</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-dark text-white py-4">
        <div class="container text-center">
            <p class="mb-0">&copy; 2024 CanteenHub. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/script.js"></script>
    <script>
        function formatCurrency(n){return '₹' + Number(n).toLocaleString()}
        function renderCart(){
            const items = window.CanteenHub.getCartItems();
            const container = document.getElementById('cartItemsContainer');
            const empty = document.getElementById('emptyCart');
            container.innerHTML = '';
            if(items.length === 0){
                empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
            }
            let subtotal = 0;
            items.forEach(item => {
                const lineTotal = item.price * item.quantity;
                subtotal += lineTotal;
                const row = document.createElement('div');
                row.className = 'cart-item d-flex align-items-center justify-content-between p-3 border rounded';
                row.style.borderColor = '#444';
                row.innerHTML = `
                    <div class="d-flex align-items-center gap-3">
                        <div>
                            <div class="fw-semibold">${item.name}</div>
                            <div class="text-muted small">${formatCurrency(item.price)}</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn btn-sm btn-outline-secondary" data-action="dec" data-id="${item.id}">-</button>
                        <input type="number" min="1" class="form-control form-control-sm text-center" style="width:70px;background:#333;border:1px solid #555;color:white;" value="${item.quantity}" data-action="qty" data-id="${item.id}" />
                        <button class="btn btn-sm btn-outline-secondary" data-action="inc" data-id="${item.id}">+</button>
                    </div>
                    <div class="text-end" style="min-width:120px;">
                        <div class="fw-semibold">${formatCurrency(lineTotal)}</div>
                        <button class="btn btn-sm btn-outline-danger mt-1" data-action="remove" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(row);
            });
            const tax = Math.round(subtotal * 0.05);
            const total = subtotal + tax;
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('tax').textContent = formatCurrency(tax);
            document.getElementById('total').textContent = formatCurrency(total);
        }

        document.addEventListener('DOMContentLoaded', function(){
            renderCart();
            document.getElementById('cartItemsContainer').addEventListener('click', function(e){
                const btn = e.target.closest('button');
                if(!btn) return;
                const id = btn.getAttribute('data-id');
                const action = btn.getAttribute('data-action');
                if(action === 'remove'){
                    window.CanteenHub.removeFromCart(id);
                } else if(action === 'inc' || action === 'dec'){
                    const items = window.CanteenHub.getCartItems();
                    const target = items.find(it => it.id === id);
                    if(target){
                        const delta = action === 'inc' ? 1 : -1;
                        const next = Math.max(1, target.quantity + delta);
                        window.CanteenHub.setQuantity(id, next);
                    }
                }
                renderCart();
            });
            document.getElementById('cartItemsContainer').addEventListener('change', function(e){
                const input = e.target;
                if(input && input.getAttribute('data-action') === 'qty'){
                    const id = input.getAttribute('data-id');
                    const val = parseInt(input.value || '1', 10);
                    window.CanteenHub.setQuantity(id, isNaN(val) ? 1 : val);
                    renderCart();
                }
            });
            document.getElementById('clearCartBtn').addEventListener('click', function(){
                window.CanteenHub.clearCart();
                renderCart();
            });
            document.getElementById('checkoutBtn').addEventListener('click', function(){
                const items = window.CanteenHub.getCartItems();
                if(items.length === 0){
                    window.CanteenHub.showAlert('Your cart is empty.', 'warning');
                    return;
                }
                window.CanteenHub.showAlert('Checkout successful! (demo) Your order has been placed.', 'success');
                window.CanteenHub.clearCart();
                renderCart();
            });
        });
    </script>
</body>
</html>


